<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Home Page</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="css/custom.css" />
</head>
<body>
    <div class="container-fluid">
        <header>
            <nav>
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active "><a href="home.html">Home</a></li>
                    <li role="presentation" class="pull-right" id="btnLogout"><a href="login.html">Logout</a></li>
                    <li role="presentation" class="pull-right"><a href="login.html">Login</a></li>
                    <li role="presentation" class="pull-right"><a href="register.html">Register</a></li>
                </ul>
            </nav>
        </header>
        <div class="container">
            <h1 class="text-left">Logged in User Name</h1>

            <div class="row">
                <div class="text-center">
                    <button type="button" class="btn btn-success" id="btnFaq">My FAQ's</button>
                    <button type="button" class="btn btn-warning" id="btnQuiz">My Quizzes</button>
                    <button type="button" class="btn btn-info" id="btnMyFaq">My FAQ's</button>
                </div>
            </div>
            <div class="row">
                <div class="faq">
                    <form class="col-md-8 col-md-offset-2">
                        <div class="form-group">

                            <label>FAQ Categories:</label><br />
                            <select class="form-control dropdown" id="dropdown"></select>
                        </div>

                        <div class="form-group">
                            <label>Question:</label>
                            <input type="text" class="form-control" id="question" placeholder="Please Enter Your Question Here?" value="This is my question" required>
                        </div>

                        <div class="form-group">
                            <label>Answer:</label>
                            <input type="text" class="form-control" id="answer" placeholder="Please Enter Your Answer Here?" value="This is the answer" required>
                        </div>

                        <div class="form-group">
                            <label>Display Order:</label>
                            <input type="number" class="form-control" id="display" value=43 placeholder="Display Order?" required>
                        </div>
                        <button type="submit" class="btn btn-success" id="btnSubQues">Submit Question</button>
                        <input type="hidden" id="faqId"/>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>
    <script src="script/sabio.services.users.js"></script>
    <script src="script/sabio.services.faqs.js"></script>

    <script type="text/javascript">
        sabio.page.startUp = function () {
            sabio.page.getUser(sabio.page.success, sabio.page.error)
            $("#btnFaq").on("click", sabio.page.handlers.onGetCategories);
            $("#btnSubQues").on("click", sabio.page.handlers.onNewFaq);
            $("#btnMyFaq").on("click", sabio.page.handlers.onViewFaqList);

            var id = location.search;
            id = id.slice(4)
            if (id) {
                sabio.page.getFaq(id, sabio.page.loadFaqSuccess, sabio.page.error)
            }
            sabio.page.getFaq(sabio.page.getUsersFaqSuccess, sabio.page.error); 
        }

        sabio.page.handlers.onNewFaq = function (e) {
            console.log("clicking")
            //$(".faq").css("display", "inherit");
            e.preventDefault();
            var data = sabio.page.readQuestion();
            sabio.page.newFaq(data, sabio.page.faqSuccess, sabio.page.error);
            var id = $("#faqId").val();
            if (id) {
                $("h1").text("-edit");
                sabio.page.editFaq(data, id, sabio.page.editSuccess, sabio.page.error);
            }
        }

        sabio.page.handlers.onGetCategories = function () {
            // $(".faq").css("display", "inherit");
            sabio.page.getCategories(sabio.page.categorySuccess, sabio.page.error);
        }

        sabio.page.handlers.onViewFaqList = function () {
            console.log("clicking")
        }

        sabio.page.readQuestion = function () {
            var questionData = {
                faqCategoryId: $("#dropdown").val(),
                question: $("#question").val(),
                answer: $("#answer").val(),
                displayOrder: $("#display").val(),
                id: $("#faqId").val()
            }
            return questionData
        }

        sabio.page.loadFaq = function (data, status, xhr) {
            sabio.page.getFaq(data, id, sabio.page.loadFaqSuccess, sabio.page.error);
        }

        sabio.page.success = function (data, status, xhr) {
            $("h1").text(data.item.firstName + " " + data.item.lastName);  
        }

        sabio.page.getUsersFaqSuccess = function (data, status, xhr) {
            console.log("success");
            console.log(data)
        }

        sabio.page.categorySuccess = function (data, status, xhr) {
            data.items.forEach(function (item) {
                $(".dropdown").append("<option value =" + item.id + ">" + item.name + "</option>");
            });
        }

        sabio.page.faqSuccess = function (data, status, xhr) {
            var id = data.item
            console.log(id)
            $("#faqId").val(id);
            $("#btnSubQues").text("Update FAQ");
        }

        sabio.page.editSuccess = function (data, status, xhr) {
            console.log("edit")
        }

        sabio.page.loadFaqSuccess = function (data, id, status, xhr) {
            $("#question").val(data.item.question)
            $("#answer").val(data.item.answer)
            $("#display").val(data.item.displayOrder)
            $(".dropdown").append("<option value = " + data.item.faqCategoryId + " > " + data.item.category + "</option>")
        }

        sabio.page.error = function (xhr, status, errorText) {
            console.log(errorText);
        }  
    </script>
</body>
</html>