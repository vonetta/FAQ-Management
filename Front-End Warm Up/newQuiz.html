<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Home Page</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="css/custom.css" />
    <link rel=icon href="https://www.google.com/url?sa=i&rct=j&q=&esrc=s&source=images&cd=&cad=rja&uact=8&ved=0ahUKEwiZmbLygJzYAhWGYiYKHTi0BkIQjRwIBw&url=https%3A%2F%2Fquiz.uludagsozluk.com%2F&psig=AOvVaw1PrE5kCzQbjrNTTyVqx92r&ust=1513976691018540">
</head>
<body>
    <div class="container-fluid">
        <header>
            <nav>
                <ul class="nav nav-default">
                    <li role="presentation" class="pull-right" id="btnLogout"><a href="#">Logout</a></li>
                    <li role="presentation" class="pull-left"><a href="home.html">Home</a></li>
                    <li role="presentation" class="pull-right" id="btnQuiz"><a href="newQuiz.html" class="active">My Quizzes</a></li>
                    <li role="presentation" class="pull-right" id="btnMyFaq"><a href="home.html">My FAQ's</a></li>
                    <li role="presentation" class="pull-right" id="btnFaq"><a href="newFaq.html">New FAQ's</a></li>
                </ul>
            </nav>
        </header>
        <div class="container">

            <div class="row">
                <h3 class="text-left">Welcome <span></span></h3>
            </div>
            <div class="row">
                <form class="well col-md-6 col-md-offset-3">
                    <input type="hidden" id="quizId" />
                    <h1 class="text-center">Create a Quiz</h1>
                    <div class="form-group">
                        <label>Quiz Name</label>
                        <input type="text" class="form-control" id="quizName" placeholder="Quiz Name">
                    </div>
                    <div class="form-group">

                        <label>Default Answer Type</label>
                        <select id="defaultAnswer" class="btn btn-default dropdown-toggle" aria-labelledby="dropdownMenu1">
                            <option value="0">Select</option>
                            <option value="Single">Single</option>
                            <option value="Multiple">Multiple</option>
                            <option value="Open">Open</option>
                        </select>
                        <br><br>
                    </div>

                    <div class="form-group">
                        <label>Randomize Question</label>
                        <p></p>
                        <label class="radio-inline">
                            <input type="radio" name="ranQues" id="ranQues1" value="true"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="ranQues" id="ranQues2" value="false" checked> No
                        </label>
                    </div>

                    <div class="form-group">
                        <label>Randomize Answer</label>
                        <p></p>
                        <label class="radio-inline">
                            <input type="radio" name="ranAns" id="inlineRadio1" value="true"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="ranAns" id="inlineRadio2" value="false" checked> No
                        </label>
                    </div>

                    <div class="form-group">
                        <label>Employee Id</label>
                        <input type="text" id="empId" />
                    </div>

                    <button type="submit" class="btn btn-default pull-right" id="btnQuizSub">Submit</button>
                </form>
            </div>
            <div class="row newQues">
            </div>
            </div>
    </div>
    <script type="text/html" id="template">
        <form class="well col-md-6 col-md-offset-3 questionForm">

            <input type="hidden" id="quizIdForQuestion"/>
            <input type="hidden" id="questionIdForQuestion" />

                    <button type="button" class="btn btn-danger pull-right" id="btnDeleteQues">X</button>
            <h1 class="text-center">Create a Question</h1>
            <div>      
              
                <div class="form-group">
                    <label>Question</label>
                    <input type="text" class="form-control" id="Questionq" placeholder="Question">
                </div>

                <div class="form-group">

                    <label>Answer Type</label>
                    <select id="questionAnswerType" class="btn btn-default dropdown-toggle" aria-labelledby="dropdownMenu1">
                        <option value="0">Select</option>
                        <option value="Single">Single</option>
                        <option value="Multiple">Multiple</option>
                        <option value="Open">Open</option>
                    </select>
                    <br><br>
                </div>

                <div class="form-group">
                    <label>Answer</label>
                    <input type="text" class="form-control" id="questionAnswer" placeholder="Answer">
                </div>

                <div class="form-group">
                    <label>Is Correct</label>
                    <p></p>
                    <label class="radio-inline">
                        <input type="radio" name="quesCorrect" id="questionRadio1" value="true"> Yes
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="quesCorrect" id="questionRadio2" value="false" checked> No
                    </label>
                </div>

                <div class="form-group">
                    <label>Sort Order</label>
                    <input type="text" class="form-control" id="questionSort" placeholder="Sort Order">
                </div>

                <div class="form-group">
                    <label>Open Answer</label>
                    <input type="text" class="form-control" id="questionOpen" placeholder="Open Answer Question">
                </div>

                <div class="form-group">
                    <label>Media</label>
                    <input type="text" class="form-control" id="media" placeholder="Media">
                </div>

                <button type="button" class="btn btn-primary pull-left" id="btnNewQues">New Question</button>
                <button type="button" class="btn btn-success pull-right" id="btnSubNewQues">Submit Question</button>
            </div>
        </form>

    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>
    <script src="script/sabio.services.users.js"></script>
    <script src="script/sabio.services.faqs.js"></script>
    <script src="script/sabio.services.quizzes.js"></script>

    <script type="text/javascript">
        sabio.page.startUp = function () {
            sabio.services.getUser(sabio.page.getUserSuccess, sabio.page.error);
            sabio.services.userEmployeeId(sabio.page.useEmployeeIdSuccess, sabio.page.onError);
            $("#btnLogout").on("click", sabio.page.handlers.onLogout);
            $("#btnQuizSub").on("click", sabio.page.handlers.onSubmitNewQuiz);
            $("#btnAddQuestion").on("click", sabio.page.handlers.onAddQuestion);
            $(".newQues").on("click", "#btnNewQues" ,sabio.page.handlers.onAddQuestion);
            $(".newQues").on("click", "#btnSubNewQues", sabio.page.handlers.onSubmitNewQuestion);
            $(".newQues").on("click", "#btnDeleteQues", sabio.page.handlers.onDeleteQuestion);
        }

        sabio.page.handlers.onSubmitNewQuiz = (e) => {    
            e.preventDefault();
            let data = sabio.page.readQuizForm();
            const id = $("#quizId").val();
            if (id) {
                sabio.services.editQuizEntry(data, id, sabio.page.quizEditSuccess, sabio.page.error);
            }
            else {
        
                sabio.services.newQuizEntry(data, sabio.page.successNewQuiz, sabio.page.error);
            }
        }

        sabio.page.handlers.onAddQuestion = (e) => {
            e.preventDefault();
            sabio.page.showNewAddedQuestion();
        }

        sabio.page.handlers.onSubmitNewQuestion = (e) => {
            e.preventDefault();
            console.log("submit question");           
            const data = sabio.page.readQuestionForm();
            sabio.services.postQuizQuestion(data, sabio.page.newQuestionSubmissionSuccess, sabio.page.error);
        } 

        sabio.page.handlers.onDeleteQuestion = () => {
            console.log("deleting question");

            var questionId = $("#questionIdForQuestion").val();
            console.log(questionId)
            sabio.services.deleteQuizQuestion( questionId, sabio.page.deleteQuestionSuccess, sabio.page.error);
        }

        sabio.page.showNewAddedQuestion = () => {
            console.log("added questions")
            const template = sabio.page.loadTemplate();
            template.find("#quizIdForQuestion").val($("#quizId").val());
            $(".newQues").append(template);
        }

        sabio.page.newQuestionSubmissionSuccess = (data, status, xhr) => {
            var id = data.item
            console.log(id)
            $("#questionIdForQuestion").val(id);
        }

        sabio.page.readQuizForm = () => {
           return quizData = {
               quizName: $("#quizName").val(),
               defaultAnswerType: $("#defaultAnswer").val(),
               randomizeQuestions: $("input[name='ranQues']:checked").val(),
               randomizeAnswers: $("input[name='ranAns']:checked").val(),
               employerId: $("#empId").val(),
               id: $("#quizId").val()
            }           
        }

        sabio.page.readQuestionForm = () => {
            return questionData = {
                quizId: $("#quizIdForQuestion").val(),
                question: $("#Questionq").val(),
                 answerType: $("#questionAnswerType").val(),
                answers: 
                [
                    {
                    answer: $("#questionAnswer").val(),
                    isCorrect: $("input[name='quesCorrect']:checked").val(),
                    sortOrder: $("#questionSort").val(),
                    }
                ],           
                openAnswer: $("#questionOpen").val(),
                media: $("#media").val()                   
            }
        }

        sabio.page.successNewQuiz = (data, status, xhr) => {
            console.log("success")
            const id = data.item;
            $("#quizId").val(id);
            $("#btnQuizSub").text("Update Quiz");
            sabio.page.showNewAddedQuestion();
            // $("#btnAddQuestion").parents("div").removeClass("hide")

        }
         
        sabio.page.deleteQuestionSuccess = function ( id, status, xhr)  {
            console.log("delete successful")
            console.log(id.item);
            $("#btnDeleteQues").closest(".questionForm").remove();
        }

        sabio.page.quizEditSuccess = (data, status, xhr) => console.log("edit success");  

        sabio.page.loadQuizSuccess = (id, status, xhr) => console.log("successfully updated");

        sabio.page.loadTemplate = () => $($("#template").html());

        sabio.page.getUserSuccess = (data, status, xhr) => $("h3 span").text(data.item.firstName + " " + data.item.lastName);

        sabio.page.getEmployeeId = (data) => sabio.services.userEmployeeId(sabio.page.useEmployeeIdSuccess, sabio.page.onError);
    
        sabio.page.useEmployeeIdSuccess = (data, status, xhr) => {
            const empId = $("#empId").val(data.item.employerId);
        }

        sabio.page.error = (xhr, status, errorText) => console.log("error");

        sabio.page.handlers.onLogout = () => sabio.services.logout(sabio.page.logoutSuccess, sabio.page.error);

        sabio.page.logoutSuccess = (data, status, xhr) => { window.location = "login.html" };    

    </script>
</body>
</html>